<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAIAEAIAAAAAQAQAIZmZkAAADAAAAAwAAABwAAABwAAAAAQAAABwAAABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA">
    <title>ğŸ“Š Dashboard Webhooks - ContrÃ´le</title>
    <link href="https://fonts.googleapis.com/css?family=Nunito:400,600,700" rel="stylesheet">
    <!-- CSS Modular -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/variables.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/components.css') }}?v=20260202-json-viewer">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/modules.css') }}">
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>
          <span class="emoji">ğŸ“Š</span>Dashboard Webhooks
        </h1>
        <a href="/logout" class="logout-link">DÃ©connexion</a>
      </div>
      
      <!-- Bandeau Statut Global -->
      <div id="globalStatusBanner" class="global-status-banner">
        <div class="status-header">
          <div class="status-title">
            <span class="status-icon" id="globalStatusIcon">ğŸŸ¢</span>
            <span class="status-text">Statut Global</span>
          </div>
          <div class="status-refresh">
            <button id="refreshStatusBtn" class="btn btn-small btn-secondary">ğŸ”„</button>
          </div>
        </div>
        <div class="status-content">
          <div class="status-item">
            <div class="status-label">DerniÃ¨re exÃ©cution</div>
            <div class="status-value" id="lastExecutionTime">â€”</div>
          </div>
          <div class="status-item">
            <div class="status-label">Incidents rÃ©cents</div>
            <div class="status-value" id="recentIncidents">â€”</div>
          </div>
          <div class="status-item">
            <div class="status-label">Erreurs critiques</div>
            <div class="status-value" id="criticalErrors">â€”</div>
          </div>
          <div class="status-item">
            <div class="status-label">Webhooks actifs</div>
            <div class="status-value" id="activeWebhooks">â€”</div>
          </div>
        </div>

      </div>
      
      <!-- Navigation principale -->
      <div class="nav-tabs" role="tablist">
        <button class="tab-btn active" data-target="#sec-overview" type="button">Vue dâ€™ensemble</button>
        <button class="tab-btn" data-target="#sec-webhooks" type="button">Webhooks</button>
        <button class="tab-btn" data-target="#sec-preferences" type="button">PrÃ©fÃ©rences</button>
        <button class="tab-btn" data-target="#sec-tools" type="button">Outils</button>
      </div>

      <!-- Section: Webhooks (panneaux pliables) -->
      <div id="sec-webhooks" class="section-panel config">
        <!-- Panneau 1: URLs & SSL -->
        <div class="collapsible-panel" data-panel="urls-ssl">
          <div class="panel-header">
            <div class="panel-title">
              <span>ğŸ”—</span>
              <span>URLs & SSL</span>
            </div>
            <div class="panel-toggle">
              <span class="panel-status" id="urls-ssl-status">Sauvegarde requise</span>
              <span class="toggle-icon">â–¼</span>
            </div>
          </div>
          <div class="panel-content">
            <div class="form-group">
              <label for="webhookUrl">Webhook PersonnalisÃ© (WEBHOOK_URL)</label>
              <input id="webhookUrl" type="text" placeholder="https://...">
            </div>
            <div style="margin-top: 15px;">
              <label class="toggle-switch" style="vertical-align: middle;">
                <input type="checkbox" id="sslVerifyToggle">
                <span class="toggle-slider"></span>
              </label>
              <span style="margin-left: 10px; vertical-align: middle;">VÃ©rification SSL (WEBHOOK_SSL_VERIFY)</span>
            </div>
            <div style="margin-top: 12px;">
              <label class="toggle-switch" style="vertical-align: middle;">
                <input type="checkbox" id="webhookSendingToggle">
                <span class="toggle-slider"></span>
              </label>
              <span style="margin-left: 10px; vertical-align: middle;">Activer l'envoi des webhooks (global)</span>
            </div>
            <div class="panel-actions">
              <button class="panel-save-btn" data-panel="urls-ssl">ğŸ’¾ Enregistrer</button>
              <span class="panel-indicator" id="urls-ssl-indicator">DerniÃ¨re sauvegarde: â€”</span>
            </div>
            <div id="urls-ssl-msg" class="status-msg"></div>
          </div>
        </div>

        <!-- Panneau 2: Absence Globale -->
        <div class="collapsible-panel" data-panel="absence">
          <div class="panel-header">
            <div class="panel-title">
              <span>ğŸš«</span>
              <span>Absence Globale</span>
            </div>
            <div class="panel-toggle">
              <span class="panel-status" id="absence-status">Sauvegarde requise</span>
              <span class="toggle-icon">â–¼</span>
            </div>
          </div>
          <div class="panel-content">
            <div style="margin-bottom: 12px;">
              <label class="toggle-switch" style="vertical-align: middle;">
                <input type="checkbox" id="absencePauseToggle">
                <span class="toggle-slider"></span>
              </label>
              <span style="margin-left: 10px; vertical-align: middle; font-weight: 600;">Activer l'absence globale (stop emails)</span>
            </div>
            <div class="small-text" style="margin-bottom: 10px;">
              Lorsque activÃ©, <strong>aucun email</strong> ne sera envoyÃ© (ni DESABO ni MÃ©dia Solution, urgent ou non) pour les jours sÃ©lectionnÃ©s ci-dessous.
            </div>
            <div class="form-group">
              <label>Jours d'absence (aucun email envoyÃ©)</label>
              <div id="absencePauseDaysGroup" class="inline-group" style="flex-wrap: wrap; gap: 12px; margin-top: 6px;">
                <label><input type="checkbox" name="absencePauseDay" value="monday"> Lundi</label>
                <label><input type="checkbox" name="absencePauseDay" value="tuesday"> Mardi</label>
                <label><input type="checkbox" name="absencePauseDay" value="wednesday"> Mercredi</label>
                <label><input type="checkbox" name="absencePauseDay" value="thursday"> Jeudi</label>
                <label><input type="checkbox" name="absencePauseDay" value="friday"> Vendredi</label>
                <label><input type="checkbox" name="absencePauseDay" value="saturday"> Samedi</label>
                <label><input type="checkbox" name="absencePauseDay" value="sunday"> Dimanche</label>
              </div>
              <div class="small-text">SÃ©lectionnez au moins un jour si vous activez l'absence.</div>
            </div>
            <div class="panel-actions">
              <button class="panel-save-btn" data-panel="absence">ğŸ’¾ Enregistrer</button>
              <span class="panel-indicator" id="absence-indicator">DerniÃ¨re sauvegarde: â€”</span>
            </div>
            <div id="absence-msg" class="status-msg"></div>
          </div>
        </div>

        <!-- Panneau 3: FenÃªtre Horaire -->
        <div class="collapsible-panel" data-panel="time-window">
          <div class="panel-header">
            <div class="panel-title">
              <span>ğŸ•</span>
              <span>FenÃªtre Horaire</span>
            </div>
            <div class="panel-toggle">
              <span class="panel-status" id="time-window-status">Sauvegarde requise</span>
              <span class="toggle-icon">â–¼</span>
            </div>
          </div>
          <div class="panel-content">
            <div style="margin-bottom: 20px;">
              <h4 style="margin: 0 0 10px 0; color: var(--cork-text-primary);">FenÃªtre Horaire Globale</h4>
              <div class="form-group">
                <label for="webhooksTimeStart">Heure de dÃ©but</label>
                <select id="webhooksTimeStart" style="width: 100%; max-width: 120px;">
                  <option value="">SÃ©lectionner...</option>
                </select>
              </div>
              <div class="form-group">
                <label for="webhooksTimeEnd">Heure de fin</label>
                <select id="webhooksTimeEnd" style="width: 100%; max-width: 120px;">
                  <option value="">SÃ©lectionner...</option>
                </select>
              </div>
              <div id="timeWindowMsg" class="status-msg"></div>
              <div id="timeWindowDisplay" class="small-text"></div>
              <div class="small-text">Laissez les deux champs vides pour dÃ©sactiver la contrainte horaire.</div>
              <div style="margin-top: 12px;">
                <button id="saveTimeWindowBtn" class="btn btn-primary btn-small">ğŸ’¾ Enregistrer FenÃªtre Globale</button>
              </div>
            </div>
            
            <div style="padding: 12px; background: rgba(67, 97, 238, 0.1); border-radius: 6px; border-left: 3px solid var(--cork-primary-accent);">
              <h4 style="margin: 0 0 10px 0; color: var(--cork-text-primary);">FenÃªtre Horaire Webhooks</h4>
              <div class="form-group" style="margin-bottom: 10px;">
                <label for="globalWebhookTimeStart">Heure de dÃ©but</label>
                <select id="globalWebhookTimeStart" style="width: 100%; max-width: 100px;">
                  <option value="">SÃ©lectionner...</option>
                </select>
              </div>
              <div class="form-group" style="margin-bottom: 10px;">
                <label for="globalWebhookTimeEnd">Heure de fin</label>
                <select id="globalWebhookTimeEnd" style="width: 100%; max-width: 100px;">
                  <option value="">SÃ©lectionner...</option>
                </select>
              </div>
              <div id="globalWebhookTimeMsg" class="status-msg" style="margin-top: 8px;"></div>
              <div class="small-text">DÃ©finissez quand les webhooks peuvent Ãªtre envoyÃ©s (laissez vide pour dÃ©sactiver).</div>
              <div style="margin-top: 12px;">
                <button id="saveGlobalWebhookTimeBtn" class="btn btn-primary btn-small">ğŸ’¾ Enregistrer FenÃªtre Webhook</button>
              </div>
            </div>
            
            <div class="panel-actions">
              <span class="panel-indicator" id="time-window-indicator">DerniÃ¨re sauvegarde: â€”</span>
            </div>
          </div>
        </div>
      <!-- Panneau 4: Routage Dynamique -->
      <div class="collapsible-panel" data-panel="routing-rules">
        <div class="panel-header">
          <div class="panel-title">
            <span>ğŸ§­</span>
            <span>Routage Dynamique</span>
            <button id="routing-rules-lock-btn" class="lock-btn" type="button" title="Verrouiller/DÃ©verrouiller l'Ã©dition des rÃ¨gles">
              <span class="lock-icon" id="routing-rules-lock-icon">ğŸ”’</span>
            </button>
          </div>
          <div class="panel-toggle">
            <span class="panel-status" id="routing-rules-status">Sauvegarde requise</span>
            <span class="toggle-icon">â–¼</span>
          </div>
        </div>
        <div class="panel-content">
          <div class="small-text" style="margin-bottom: 10px;">
            DÃ©finissez des rÃ¨gles conditionnelles pour router les emails vers des webhooks dÃ©diÃ©s.
            Les rÃ¨gles sont Ã©valuÃ©es dans l'ordre affichÃ©.
          </div>
          <div class="inline-group" style="margin-bottom: 12px;">
            <button id="addRoutingRuleBtn" type="button" class="btn btn-primary btn-small">â• Ajouter une rÃ¨gle</button>
            <button id="reloadRoutingRulesBtn" type="button" class="btn btn-secondary btn-small">ğŸ”„ Recharger</button>
          </div>
          <div id="routingRulesList" class="routing-rules-list"></div>
          <div class="panel-actions">
            <span class="panel-indicator" id="routing-rules-indicator">DerniÃ¨re sauvegarde: â€”</span>
          </div>
          <div id="routing-rules-msg" class="status-msg"></div>
          <div id="routingRulesRedisInspectMsg" class="status-msg" style="margin-top: 12px;"></div>
          <pre id="routingRulesRedisInspectLog" class="code-block small-text" style="display:none;margin-top:12px;"></pre>
          <div id="routingRulesRedisInspectViewer" class="json-viewer-container" style="display:none;"></div>
        </div>
      </div>
      </div>

      
      <!-- Section: PrÃ©fÃ©rences (filtres + fiabilitÃ©) -->
      <div id="sec-preferences" class="section-panel">
        <div class="card">
          <div class="card-title">ğŸ” Filtres Email AvancÃ©s</div>
          <div class="form-group">
            <label for="excludeKeywordsRecadrage">Mots-clÃ©s Ã  exclure (Recadrage) â€” un par ligne</label>
            <textarea id="excludeKeywordsRecadrage" rows="4" style="width:100%; padding:10px; border-radius:4px; border:1px solid var(--cork-border-color); background: rgba(0,0,0,0.2); color: var(--cork-text-primary);"></textarea>
            <div class="small-text">Ces mots-clÃ©s empÃªcheront l'envoi du webhook `RECADRAGE_MAKE_WEBHOOK_URL` si trouvÃ©s dans le sujet ou le corps.</div>
          </div>
          <div class="form-group">
            <label for="excludeKeywordsAutorepondeur">Mots-clÃ©s Ã  exclure (AutorÃ©pondeur) â€” un par ligne</label>
            <textarea id="excludeKeywordsAutorepondeur" rows="4" style="width:100%; padding:10px; border-radius:4px; border:1px solid var(--cork-border-color); background: rgba(0,0,0,0.2); color: var(--cork-text-primary);"></textarea>
            <div class="small-text">Ces mots-clÃ©s empÃªcheront l'envoi du webhook `AUTOREPONDEUR_MAKE_WEBHOOK_URL` si trouvÃ©s dans le sujet ou le corps.</div>
          </div>
          <div class="form-group">
            <label for="excludeKeywords">Mots-clÃ©s Ã  exclure (global, compatibilitÃ©) â€” un par ligne</label>
            <textarea id="excludeKeywords" rows="3" style="width:100%; padding:10px; border-radius:4px; border:1px solid var(--cork-border-color); background: rgba(0,0,0,0.2); color: var(--cork-text-primary);"></textarea>
            <div class="small-text">Liste globale (hÃ©ritage). S'applique avant toute logique et avant les listes spÃ©cifiques.</div>
          </div>
          <div class="form-group">
            <label for="attachmentDetectionToggle">DÃ©tection de piÃ¨ces jointes requise</label>
            <label class="toggle-switch" style="vertical-align: middle; margin-left:10px;">
              <input type="checkbox" id="attachmentDetectionToggle">
              <span class="toggle-slider"></span>
            </label>
          </div>
          <div class="form-group">
            <label for="maxEmailSizeMB">Taille maximale des emails Ã  traiter (Mo)</label>
            <input id="maxEmailSizeMB" type="number" min="1" max="100" placeholder="ex: 25">
          </div>
          <div class="form-group">
            <label for="senderPriority">PrioritÃ© des expÃ©diteurs (JSON simple)</label>
            <textarea id="senderPriority" rows="3" placeholder='{"vip@example.com":"high","team@example.com":"medium"}' style="width:100%; padding:10px; border-radius:4px; border:1px solid var(--cork-border-color); background: rgba(0,0,0,0.2); color: var(--cork-text-primary);"></textarea>
            <div class="small-text">Format: { "email": "high|medium|low", ... } â€” ValidÃ© cÃ´tÃ© client uniquement pour l'instant.</div>
          </div>
        </div>
        <div class="card" style="margin-top: 20px;">
          <div class="card-title">âš¡ ParamÃ¨tres de FiabilitÃ©</div>
          <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 10px;">
            <div class="form-group">
              <label for="retryCount">Nombre de tentatives (retries)</label>
              <input id="retryCount" type="number" min="0" max="10" placeholder="ex: 3">
            </div>
            <div class="form-group">
              <label for="retryDelaySec">DÃ©lai entre retries (secondes)</label>
              <input id="retryDelaySec" type="number" min="0" max="600" placeholder="ex: 10">
            </div>
            <div class="form-group">
              <label for="webhookTimeoutSec">Timeout Webhook (secondes)</label>
              <input id="webhookTimeoutSec" type="number" min="1" max="120" placeholder="ex: 30">
            </div>
            <div class="form-group">
              <label for="rateLimitPerHour">Limite d'envoi (webhooks/heure)</label>
              <input id="rateLimitPerHour" type="number" min="1" max="10000" placeholder="ex: 300">
            </div>
          </div>
          <div style="margin-top: 8px;">
            <label class="toggle-switch" style="vertical-align: middle;">
              <input type="checkbox" id="notifyOnFailureToggle">
              <span class="toggle-slider"></span>
            </label>
            <span style="margin-left: 10px; vertical-align: middle;">Notifications d'Ã©chec par email (UI-only)</span>
          </div>
          <div style="margin-top: 12px;">
            <button id="processingPrefsSaveBtn" class="btn btn-primary">ğŸ’¾ Enregistrer PrÃ©fÃ©rences de Traitement</button>
            <div id="processingPrefsMsg" class="status-msg"></div>
          </div>
        </div>
      </div>

      <!-- Section: Vue d'ensemble (logs) -->
      <div id="sec-overview" class="section-panel monitoring active">
        <div class="logs-container">
          <div class="card-title">ğŸ“œ Historique des Webhooks (7 derniers jours)</div>
          <div style="margin-bottom: 15px;">
            <button id="refreshLogsBtn" class="btn btn-primary">ğŸ”„ Actualiser</button>
          </div>
          <div id="webhookLogs">
            <div class="log-empty">Chargement des logs...</div>
          </div>
        </div>
      </div>

      <!-- Section: Outils (config mgmt + outils de test) -->
      <div id="sec-tools" class="section-panel">
        <div class="card">
          <div class="card-title">ğŸ’¾ Gestion des Configurations</div>
          <div class="inline-group" style="margin-bottom: 10px;">
            <button id="exportConfigBtn" class="btn btn-primary">â¬‡ï¸ Exporter</button>
            <input id="importConfigFile" type="file" accept="application/json" style="display:none;"/>
            <button id="importConfigBtn" class="btn btn-primary">â¬†ï¸ Importer</button>
          </div>
          <div id="configMgmtMsg" class="status-msg"></div>
          <div class="small-text">L'export inclut la configuration serveur (webhooks, polling, fenÃªtre horaire) + prÃ©fÃ©rences UI locales (filtres, fiabilitÃ©). L'import applique automatiquement ce qui est supportÃ© par les endpoints existants.</div>
        </div>
        <div class="card" style="margin-top: 20px;">
          <div class="card-title">ğŸš€ DÃ©ploiement de l'application</div>
          <div class="form-group">
            <p class="small-text">Certaines modifications (ex: paramÃ¨tres applicatifs, configuration reverse proxy) nÃ©cessitent un dÃ©ploiement pour Ãªtre pleinement appliquÃ©es.</p>
          </div>
          <div class="inline-group" style="margin-bottom: 10px;">
            <button id="restartServerBtn" class="btn btn-success">ğŸš€ DÃ©ployer l'application</button>
          </div>
          <div id="restartMsg" class="status-msg"></div>
          <div class="small-text">Cette action dÃ©clenche un dÃ©ploiement cÃ´tÃ© serveur (commande configurÃ©e). L'application peut Ãªtre momentanÃ©ment indisponible.</div>
        </div>
        <div class="card" style="margin-top: 20px;">
          <div class="card-title">ğŸ—‚ï¸ Migration configs â†’ Redis</div>
          <p>Rejouez le script <code>migrate_configs_to_redis.py</code> directement sur le serveur Render avec toutes les variables d'environnement de production.</p>
          <div class="inline-group" style="margin-bottom: 10px;">
            <button id="migrateConfigsBtn" class="btn btn-warning">ğŸ“¦ Migrer les configurations</button>
          </div>
          <div id="migrateConfigsMsg" class="status-msg"></div>
          <pre id="migrateConfigsLog" class="code-block small-text" style="display:none;margin-top:12px;"></pre>
          <hr style="margin: 18px 0; border-color: rgba(255,255,255,0.1);">
          <p style="margin-bottom:10px;">VÃ©rifiez l'Ã©tat des donnÃ©es persistÃ©es dans Redis (structures JSON, attributs requis, dates de mise Ã  jour).</p>
          <div class="inline-group" style="margin-bottom: 10px;">
            <button id="verifyConfigStoreBtn" class="btn btn-info">ğŸ” VÃ©rifier les donnÃ©es en Redis</button>
          </div>
          <label for="verifyConfigStoreRawToggle" class="small-text" style="display:flex; align-items:center; gap:8px; margin-bottom:10px;">
            <input type="checkbox" id="verifyConfigStoreRawToggle">
            <span>Inclure le JSON complet dans le log pour faciliter le debug.</span>
          </label>
          <div id="verifyConfigStoreMsg" class="status-msg"></div>
          <pre id="verifyConfigStoreLog" class="code-block small-text" style="display:none;margin-top:12px;"></pre>
          <div id="verifyConfigStoreViewer" class="json-viewer-container" style="display:none;"></div>
        </div>
        <div class="card" style="margin-top: 20px;">
          <div class="card-title">ğŸ” AccÃ¨s Magic Link</div>
          <p>GÃ©nÃ©rez un lien prÃ©-authentifiÃ© Ã  usage unique pour ouvrir rapidement le dashboard sans retaper vos identifiants. Le lien est automatiquement copiÃ©.</p>
          <div class="inline-group" style="margin-bottom: 12px;">
            <label class="toggle-switch">
              <input type="checkbox" id="magicLinkUnlimitedToggle">
              <span class="toggle-slider"></span>
            </label>
            <span style="margin-left: 10px;">
              Mode illimitÃ© (dÃ©sactivÃ© = lien one-shot avec expiration)
            </span>
          </div>
          <button id="generateMagicLinkBtn" class="btn btn-primary">âœ¨ GÃ©nÃ©rer un magic link</button>
          <div id="magicLinkOutput" class="status-msg" style="margin-top: 12px;"></div>
          <div class="small-text">
            Important : partagez ce lien uniquement avec des personnes autorisÃ©es.
            En mode one-shot, il expire aprÃ¨s quelques minutes et s'invalide dÃ¨s qu'il est utilisÃ©.
            En mode illimitÃ©, aucun dÃ©lai mais vous devez rÃ©voquer manuellement en cas de fuite.
          </div>
        </div>
        <div class="card" style="margin-top: 20px;">
          <div class="card-title">ğŸ§ª Outils de Test</div>
          <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 10px;">
            <div class="form-group">
              <label for="testWebhookUrl">Valider une URL de webhook</label>
              <input id="testWebhookUrl" type="text" placeholder="https://hook.eu2.make.com/<token> ou <token>@hook.eu2.make.com">
              <button id="validateWebhookUrlBtn" class="btn btn-primary" style="margin-top: 8px;">Valider</button>
              <div id="webhookUrlValidationMsg" class="status-msg"></div>
            </div>
            <div class="form-group">
              <label>PrÃ©visualiser un payload</label>
              <input id="previewSubject" type="text" placeholder="Sujet d'email (ex: MÃ©dia Solution - Lot 123)">
              <input id="previewSender" type="email" placeholder="ExpÃ©diteur (ex: media@solution.fr)" style="margin-top: 6px;">
              <textarea id="previewBody" rows="4" placeholder="Corps de l'email (coller du texte)" style="margin-top: 6px; width:100%; padding:10px; border-radius:4px; border:1px solid var(--cork-border-color); background: rgba(0,0,0,0.2); color: var(--cork-text-primary);"></textarea>
              <button id="buildPayloadPreviewBtn" class="btn btn-primary" style="margin-top: 8px;">GÃ©nÃ©rer</button>
              <pre id="payloadPreview" style="margin-top:8px; background: rgba(0,0,0,0.2); border:1px solid var(--cork-border-color); padding:10px; border-radius:4px; max-height:200px; overflow:auto; color: var(--cork-text-primary);"></pre>
            </div>
          </div>
          <div class="small-text">Le test de connectivitÃ© IMAP en temps rÃ©el nÃ©cessitera un endpoint serveur dÃ©diÃ© (non inclus pour l'instant).</div>
        </div>
        <div class="card" style="margin-top: 20px;">
          <div class="card-title">ğŸ”— Ouvrir une page de tÃ©lÃ©chargement</div>
          <div class="form-group">
            <label for="downloadPageUrl">URL de la page de tÃ©lÃ©chargement (Dropbox / FromSmash / SwissTransfer)</label>
            <input id="downloadPageUrl" type="url" placeholder="https://www.swisstransfer.com/d/<uuid> ou https://fromsmash.com/<id>">
            <button id="openDownloadPageBtn" class="btn btn-primary" style="margin-top: 8px;">Ouvrir la page</button>
            <div id="openDownloadMsg" class="status-msg"></div>
            <div class="small-text">Note: L'application n'essaie plus d'extraire des liens de tÃ©lÃ©chargement directs. Utilisez ce bouton pour ouvrir la page d'origine et tÃ©lÃ©charger manuellement.</div>
          </div>
        </div>
        <div class="card" style="margin-top: 20px;">
          <div class="card-title"> Flags Runtime (Debug)</div>
          <div class="form-group">
            <label>Bypass dÃ©duplication par ID dâ€™email (debug)</label>
            <label class="toggle-switch" style="vertical-align: middle; margin-left:10px;">
              <input type="checkbox" id="disableEmailIdDedupToggle">
              <span class="toggle-slider"></span>
            </label>
            <div class="small-text">Quand activÃ©, ignore la dÃ©duplication par ID d'email. Ã€ utiliser uniquement pour des tests.
            </div>
          </div>
          <div class="form-group" style="margin-top: 10px;">
            <label>Autoriser envoi CUSTOM sans liens de livraison</label>
            <label class="toggle-switch" style="vertical-align: middle; margin-left:10px;">
              <input type="checkbox" id="allowCustomWithoutLinksToggle">
              <span class="toggle-slider"></span>
            </label>
            <div class="small-text">Si dÃ©sactivÃ© (recommandÃ©), l'envoi CUSTOM est ignorÃ© lorsquâ€™aucun lien (Dropbox/FromSmash/SwissTransfer) nâ€™est dÃ©tectÃ©, pour Ã©viter les 422.</div>
          </div>
          <div style="margin-top: 12px;">
            <button id="runtimeFlagsSaveBtn" class="btn btn-primary"> Enregistrer Flags Runtime</button>
            <div id="runtimeFlagsMsg" class="status-msg"></div>
          </div>
        </div>
      </div>
    </div>
    <!-- Chargement des modules JavaScript -->
    <script type="module" src="{{ url_for('static', filename='utils/MessageHelper.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='services/ApiService.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='services/WebhookService.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='services/LogService.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='components/TabManager.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='dashboard.js') }}?v=20260202-json-viewer"></script>
  </body>
</html>